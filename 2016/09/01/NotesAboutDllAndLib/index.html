<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Notes about dll and lib | Kover's loft</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Notes about dll and lib</h1><a id="logo" href="/.">Kover's loft</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Notes about dll and lib</h1><div class="post-meta">Sep 1, 2016<span> | </span><span class="category"><a href="/categories/C-C/">C/C++</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>Suppose test.lib is built as a static library, its source code will be included when other program depends on this lib. But if the test2.lib is an intermediate product when building test2.dll, the other program depends on this lib will load the corresponding dll when starting. And by loading the dynamic library, all interface in the lib file will be checked. Here, I did some test.</p>
<p>Project Testdll builds Testdll.cpp to Testdll.dll and Testdll.lib intermediately.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//File name: Testdll.h</div><div class="line">#define DllImportExport __declspec(dllexport)</div><div class="line">struct TestStruct</div><div class="line">&#123;</div><div class="line">    int m1;</div><div class="line">    int m2;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">class DllImportExport Testdll</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    virtual void fun1();</div><div class="line">    void fun2();</div><div class="line">    TestStruct* fun3(TestStruct* p);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//File name: Testdll.cpp</div><div class="line">#include &quot;Testdll.h&quot;</div><div class="line">#include &lt;windows.h&gt;</div><div class="line"></div><div class="line">void Testdll::fun1()</div><div class="line">&#123; </div><div class="line">    OutputDebugString(&quot;virtual Testdll::fun1\n&quot;); </div><div class="line">&#125;</div><div class="line"></div><div class="line">void Testdll::fun2()</div><div class="line">&#123;</div><div class="line">    OutputDebugString(&quot;Testdll::fun2\n&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">TestStruct* Testdll::fun3(TestStruct* p)</div><div class="line">&#123;</div><div class="line">    OutputDebugString(&quot;Testdll::fun3\n&quot;);</div><div class="line">    return p;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Project Testexe builds Testexe.cpp to a executable program Testexe.exe, depends on Testdll.dll.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#include &quot;Testdll.h&quot;</div><div class="line"></div><div class="line">void main()</div><div class="line">&#123;</div><div class="line">    Testdll a;</div><div class="line">    a.fun1();</div><div class="line">    a.fun2();</div><div class="line">    //TestStruct* p = a.fun3(NULL);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Project Testhook will hook the Testdll.dll. If it builds with Testhook.cpp and Testhook.h, it can hooks the testdll.dll successfully. When changing the filename from Testhook.dll to Testdll.dll covering the former one, the functions in the Testhook will be invoked by the program Testexe.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//File name: Testhook.h</div><div class="line">#define DllImportExport __declspec(dllexport)</div><div class="line">struct TestStruct;</div><div class="line">class DllImportExport Testdll</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    virtual void fun1();</div><div class="line">    void fun2();</div><div class="line">    TestStruct* fun3(TestStruct* p);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//File name: Testhook.cpp</div><div class="line">#include &quot;Testhook.h&quot;</div><div class="line">#include &lt;windows.h&gt;</div><div class="line"></div><div class="line">void Testdll::fun1()</div><div class="line">&#123; </div><div class="line">    OutputDebugString(&quot;virtual Testhook::fun1\n&quot;); </div><div class="line">&#125;</div><div class="line"></div><div class="line">void Testdll::fun2()</div><div class="line">&#123;</div><div class="line">    OutputDebugString(&quot;Testhook::fun2\n&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">TestStruct* Testdll::fun3(TestStruct* p)</div><div class="line">&#123;</div><div class="line">    OutputDebugString(&quot;Testhook::fun3\n&quot;);</div><div class="line">    return p;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If Testhook builts with Testhook1.h or Testhook2.h, the Testexe can not load the dll successfully. That is to say the virtual and non-virtual function is distinguished by the exporting of dynamic library.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//File name: Testhook1.h</div><div class="line">#define DllImportExport __declspec(dllexport)</div><div class="line">struct TestStruct;</div><div class="line">class DllImportExport Testdll</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    virtual void fun1();</div><div class="line">    virtual void fun2();</div><div class="line">    TestStruct* fun3(TestStruct* p);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//File name: Testhook2.h</div><div class="line">#define DllImportExport __declspec(dllexport)</div><div class="line">struct TestStruct;</div><div class="line">class DllImportExport Testdll</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    void fun1();</div><div class="line">    void fun2();</div><div class="line">    TestStruct* fun3(TestStruct* p);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>If Testhook builts with Testhook3.h, the Testexe can not load the dll successfully. The program will check all interfaces in the lib which is imported even some of them won’t be invoked.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//File name: Testhook3.h</div><div class="line">#define DllImportExport __declspec(dllexport)</div><div class="line">class DllImportExport Testdll</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    void fun1();</div><div class="line">    void fun2();</div><div class="line">    void* fun3(void* p);    //delete this line will also cause the same result</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/09/01/NotesAboutDllAndLib/" data-id="cisk1cnxn0001y4oiztzwi9fk" class="article-share-link">Share</a><div class="tags"></div><div class="post-nav"><a href="/2016/09/01/Notes about dll and lib/" class="next">Notes about dll and lib</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sitelog/">sitelog</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/NotesAboutDllAndLib/">Notes about dll and lib</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/01/Notes about dll and lib/">Notes about dll and lib</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/31/Welcome/">Welcome to my blog</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/30/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Kover's loft.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>